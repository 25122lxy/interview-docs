# 消息中间件MQ

## MQ

### 为什么要用MQ✔✏️

使用MQ的场景很多，主要有三个：解耦、异步、削峰。

- 解耦：假设现在，日志不光要**插入到数据库**里，还要**在硬盘中增加文件类型的日志**，同时，一些**关键日志还要通过邮件的方式发送给指定的人**。那么，如果按照原来的逻辑，A可能就需要在原来的代码上做扩展，除了B服务，还要加上日志文件的存储和日志邮件的发送。但是，如果你使用了MQ，那么，A服务是不需要做更改的，**它还是将消息放到MQ中即可，其它的服务，无论是原来的B服务还是新增的日志文件存储服务或日志邮件发送服务，都直接从MQ中获取消息并处理即可**。这就是解耦，它的好处是提高系统灵活性，扩展性。

- 异步：可以将一些非核心流程，如日志，短信，邮件等，通过MQ的方式异步去处理。这样做的好处是缩短主流程的响应时间，提升用户体验。

- 削峰：MQ的本质就是业务的排队。所以，面对突然到来的高并发，MQ也可以不用慌忙，先排好队，不要着急，一个一个来。削峰的好处就是避免高并发压垮系统的关键组件，如某个核心服务或数据库等。

  举个例子，假设订单系统最多能处理一万次订单，但是在高峰期，如果有两万次下单操作系统是处理不了的，只能限制订单超过一万后不允许用户下单。使用消息队列做缓冲，我们可以取消这个限制，把一秒内下的订单分散成一段时间来处理，**这时有些用户可能在下单十几秒后才能收到下单成功的操作**，但是比不能下单的体验要好。

### 消息队列的缺点✔

1、 <font color=red>**系统可用性降低**</font>

系统引入的外部依赖越多，越容易挂掉。

2、 系统复杂度提高

加入了消息队列，要多考虑很多方面的问题，比如：一致性问题、如何保证消息不被重复消费、如何保证消息可靠性传输等。因此，需要考虑的东西更多，复杂性增大。

3、 一致性问题

A 系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是，要是 BCD 三个系统那里，BD 两个系统写库成功了，结果 C 系统写库失败了，这就数据不一致了。

### Kafka、ActiveMQ、RabbitMQ、RocketMQ 有什么优缺点✔



## RabbitMQ

### RabbitMQ-如何保证消息不丢失✔



### RabbitMQ消息的重复消费问题如何解决的✔



### 那你还知道其他的解决方案吗✔



### RabbitMQ中死信交换机（RabbitMQ延迟队列有了解过嘛）✔



### 如果有100万消息堆积在MQ , 如何解决✔



### RabbitMQ的高可用机制有了解过嘛✔



### 那出现丢数据怎么解决呢✔



### 说说Broker服务节点、Queue队列、Exchange交换器



## Kafka

### 什么是Apache Kafka



### Kafka都有哪些特点✔



### Kafka 的设计架构✔



### Kafka消息是采用Pull模式，还是Push模式✔



### Kafka是如何保证消息不丢失✔



### kafka 的数据是放在磁盘上还是内存上，为什么速度会快




### Kafka中消息的重复消费问题如何解决的✔



### Kafka是如何保证消费的顺序性✔



### Kafka的高可用机制有了解过嘛✔



### 解释一下复制机制中的ISR✔



### Kafka数据清理机制了解过嘛✔



### Kafka中实现高性能的设计有了解过嘛✔



### Kafka的优化



## RocketMQ



